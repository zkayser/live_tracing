{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../src/utils.ts"],"names":[],"mappings":";AAAA;;;;;;;;;;;;;;GAcG;;;AAGH,8CAAoD;AACpD,gEAKsC;AACtC,mDAAgD;AAEzC,MAAM,+BAA+B,GAAG,GAAuB,EAAE;;IACtE,MAAM,OAAO,GAAuB,EAAE,CAAC;IACvC,MAAM,2BAA2B,GAAG,MAAA,MAClC,oBACD,EAAC,gBAAgB,mDAAG,YAAY,EAAE,CAAC,CAAuB,CAAC;IAE5D,IAAI,2BAA2B,EAAE;QAC/B,MAAM,IAAI,GAAG,MAAM,CAAC,MAAM,CAAC,sCAAG,CAAC,CAAC;QAChC,IAAI,CAAC,OAAO,CAAC,CAAC,GAAW,EAAE,EAAE;YAC3B,IAAI,IAAA,sBAAM,EAAC,2BAA2B,EAAE,GAAG,CAAC,EAAE;gBAC5C,MAAM,KAAK,GAAG,2BAA2B,CAAC,GAAG,CAAC,CAAC;gBAC/C,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE;oBAC7B,OAAO,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;iBACtB;aACF;QACH,CAAC,CAAC,CAAC;KACJ;SAAM;QACL,kCAAkC;QAClC,MAAM,IAAI,GAA6C,oBAAa,CAAC;QACrE,MAAM,iBAAiB,GAAG,IAAI,CAAC,MAAM,CAAC;QACtC,IAAI,iBAAiB,EAAE;YACrB,MAAM,IAAI,GAAG,MAAM,CAAC,MAAM,CAAC,sCAAG,CAAC,CAAC;YAChC,IAAI,CAAC,OAAO,CAAC,CAAC,GAAW,EAAE,EAAE;gBAC3B,IAAI,IAAA,sBAAM,EAAC,iBAAiB,EAAE,GAAG,CAAC,EAAE;oBAClC,MAAM,KAAK,GAAG,iBAAiB,CAAC,GAAG,CAAC,CAAC;oBACrC,IAAI,OAAO,KAAK,KAAK,QAAQ,EAAE;wBAC7B,OAAO,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC;qBACtB;iBACF;YACH,CAAC,CAAC,CAAC;SACJ;KACF;IAED,OAAO,OAAO,CAAC;AACjB,CAAC,CAAC;AAlCW,QAAA,+BAA+B,mCAkC1C;AAEF,MAAM,qBAAqB,GAAG;IAC5B,aAAa,EAAE,uBAAU,CAAC,WAAW;IACrC,wBAAwB,EAAE,uBAAU,CAAC,sBAAsB;CAC5D,CAAC;AAEK,MAAM,6BAA6B,GAAG,CAAC,IAAU,EAAE,EAAE;;IAC1D,MAAM,sBAAsB,GAAG,MAAA,MAC7B,oBACD,EAAC,gBAAgB,mDAAG,OAAO,CAAC,CAAC;IAC9B,IAAI,sBAAsB,EAAE;QAC1B,sBAAsB,CAAC,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,SAAS,EAAE,EAAE,EAAE;YACrD,IAAI,IAAA,sBAAM,EAAC,qBAAqB,EAAE,IAAI,CAAC,EAAE;gBACvC,IAAI,CAAC,QAAQ,CAAC,qBAAqB,CAAC,IAAI,CAAC,EAAE,SAAS,CAAC,CAAC;aACvD;QACH,CAAC,CAAC,CAAC;KACJ;AACH,CAAC,CAAC;AAXW,QAAA,6BAA6B,iCAWxC","sourcesContent":["/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Span } from '@opentelemetry/api';\nimport { otperformance } from '@opentelemetry/core';\nimport {\n  hasKey,\n  PerformanceEntries,\n  PerformanceLegacy,\n  PerformanceTimingNames as PTN,\n} from '@opentelemetry/sdk-trace-web';\nimport { EventNames } from './enums/EventNames';\n\nexport const getPerformanceNavigationEntries = (): PerformanceEntries => {\n  const entries: PerformanceEntries = {};\n  const performanceNavigationTiming = (\n    otperformance as unknown as Performance\n  ).getEntriesByType?.('navigation')[0] as PerformanceEntries;\n\n  if (performanceNavigationTiming) {\n    const keys = Object.values(PTN);\n    keys.forEach((key: string) => {\n      if (hasKey(performanceNavigationTiming, key)) {\n        const value = performanceNavigationTiming[key];\n        if (typeof value === 'number') {\n          entries[key] = value;\n        }\n      }\n    });\n  } else {\n    // // fallback to previous version\n    const perf: typeof otperformance & PerformanceLegacy = otperformance;\n    const performanceTiming = perf.timing;\n    if (performanceTiming) {\n      const keys = Object.values(PTN);\n      keys.forEach((key: string) => {\n        if (hasKey(performanceTiming, key)) {\n          const value = performanceTiming[key];\n          if (typeof value === 'number') {\n            entries[key] = value;\n          }\n        }\n      });\n    }\n  }\n\n  return entries;\n};\n\nconst performancePaintNames = {\n  'first-paint': EventNames.FIRST_PAINT,\n  'first-contentful-paint': EventNames.FIRST_CONTENTFUL_PAINT,\n};\n\nexport const addSpanPerformancePaintEvents = (span: Span) => {\n  const performancePaintTiming = (\n    otperformance as unknown as Performance\n  ).getEntriesByType?.('paint');\n  if (performancePaintTiming) {\n    performancePaintTiming.forEach(({ name, startTime }) => {\n      if (hasKey(performancePaintNames, name)) {\n        span.addEvent(performancePaintNames[name], startTime);\n      }\n    });\n  }\n};\n"]}